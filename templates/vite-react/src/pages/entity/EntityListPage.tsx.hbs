/**
 * {{entity.name}} List Page
 * Generated by Dashboard Generator
 */

import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { PageHeader } from '@/components/layout';
import { DataTable, Column } from '@/components/tables';
import { Button, Badge, getStatusVariant, ConfirmModal } from '@/components/ui';
import { use{{entity.pluralName}}, use{{entity.name}}Mutations } from '@/hooks/use{{entity.pluralName}}';
import { formatDate, formatCurrency } from '@/utils/format';
import type { {{entity.name}} } from '@/types';

export function {{entity.name}}ListPage() {
  const navigate = useNavigate();
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState('');
  const [sortField, setSortField] = useState('{{entity.listConfig.defaultSort.field}}');
  const [sortDirection, setSortDirection] = useState<'asc' | 'desc'>('{{entity.listConfig.defaultSort.direction}}');

  // Delete confirmation
  const [deleteId, setDeleteId] = useState<string | null>(null);
  const [isDeleting, setIsDeleting] = useState(false);

  const { {{camelCase entity.pluralName}}, total, isLoading } = use{{entity.pluralName}}({
    page,
    search,
    sort: sortField,
    sortDirection,
  });

  const { delete{{entity.name}} } = use{{entity.name}}Mutations();

  const handleSort = (field: string) => {
    if (sortField === field) {
      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
    } else {
      setSortField(field);
      setSortDirection('asc');
    }
  };

  const handleDelete = async () => {
    if (!deleteId) return;

    setIsDeleting(true);
    const success = await delete{{entity.name}}(deleteId);
    setIsDeleting(false);

    if (success) {
      setDeleteId(null);
    }
  };

  const columns: Column<{{entity.name}}>[] = [
{{#each entity.fields}}
{{#if showInList}}
    {
      key: '{{name}}',
      header: '{{label}}',
      sortable: true,
{{#if (eq type "enum")}}
      render: (value) => (
        <Badge variant={getStatusVariant(String(value))}>
          {String(value)}
        </Badge>
      ),
{{else if (eq type "boolean")}}
      render: (value) => (
        <Badge variant={value ? 'success' : 'default'}>
          {value ? 'Yes' : 'No'}
        </Badge>
      ),
{{else if (eq type "date")}}
      render: (value) => formatDate(String(value)),
{{else if (eq type "datetime")}}
      render: (value) => formatDate(String(value)),
{{else if (eq type "number")}}
{{#if (eq name "price")}}
      render: (value) => formatCurrency(value as number),
{{/if}}
{{/if}}
    },
{{/if}}
{{/each}}
  ];

  return (
    <div>
      <PageHeader
        title="{{entity.pluralName}}"
        description="Manage your {{lowerCase entity.pluralName}}"
        breadcrumbs={[
          { label: 'Dashboard', href: '/' },
          { label: '{{entity.pluralName}}' },
        ]}
        action={
          <Link to="/{{entity.slug}}/new">
            <Button>Add {{entity.name}}</Button>
          </Link>
        }
      />

      <DataTable<{{entity.name}}>
        data={ {{camelCase entity.pluralName}} }
        columns={columns}
        isLoading={isLoading}
        searchValue={search}
        onSearchChange={setSearch}
        searchPlaceholder="Search {{lowerCase entity.pluralName}}..."
        sortField={sortField}
        sortDirection={sortDirection}
        onSort={handleSort}
        pagination=\{{
          page,
          pageSize: {{entity.listConfig.pageSize}},
          total,
          onPageChange: setPage,
        }}
        onRowClick={(row) => navigate(`/{{entity.slug}}/${row.id}`)}
        actions={(row) => (
          <div className="flex items-center justify-end gap-2">
            <Link
              to={`/{{entity.slug}}/${row.id}`}
              className="text-sm text-gray-600 hover:text-gray-900"
            >
              View
            </Link>
            <Link
              to={`/{{entity.slug}}/${row.id}/edit`}
              className="text-sm text-primary-600 hover:text-primary-700"
            >
              Edit
            </Link>
            <button
              onClick={(e) => {
                e.stopPropagation();
                setDeleteId(row.id);
              }}
              className="text-sm text-red-600 hover:text-red-700"
            >
              Delete
            </button>
          </div>
        )}
      />

      {/* Delete confirmation modal */}
      <ConfirmModal
        isOpen={!!deleteId}
        onClose={() => setDeleteId(null)}
        onConfirm={handleDelete}
        title="Delete {{entity.name}}"
        message="Are you sure you want to delete this {{lowerCase entity.name}}? This action cannot be undone."
        confirmLabel="Delete"
        variant="danger"
        isLoading={isDeleting}
      />
    </div>
  );
}

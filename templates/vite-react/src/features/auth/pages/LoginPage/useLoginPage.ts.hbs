import { useState } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { useAuthStore } from '@/stores/authStore';
import type { LoginFormData } from './LoginPage.types';
import type { FormState } from 'informed';

interface LocationState {
  from?: { pathname: string };
}

export function useLoginPage() {
  const navigate = useNavigate();
  const location = useLocation();
  const { login, isLoading } = useAuthStore();

  const [error, setError] = useState('');

  const from = (location.state as LocationState)?.from?.pathname || '/';

  const handleSubmit = async ({ values }: FormState<LoginFormData>) => {
    setError('');

    if (!values.email || !values.password) {
      setError('Please enter email and password');
      return;
    }

    // For MVP, use mock authentication
    await new Promise((resolve) => setTimeout(resolve, 500));

    const mockUser = {
      id: '1',
      email: values.email,
      name: values.email.split('@')[0],
    };
    const mockToken = 'mock-jwt-token-' + Date.now();

    login(mockUser, mockToken);
    navigate(from, { replace: true });
  };

  return {
    error,
    isLoading,
    handleSubmit,
  };
}

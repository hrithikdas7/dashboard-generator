import { useState } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { useAuthStore } from '@/stores/authStore';
import type { LoginFormData } from './LoginPage.types';

interface LocationState {
  from?: { pathname: string };
}

export function useLoginPage() {
  const navigate = useNavigate();
  const location = useLocation();
  const { login, isLoading } = useAuthStore();

  const [formData, setFormData] = useState<LoginFormData>({
    email: '',
    password: '',
  });
  const [error, setError] = useState('');

  const from = (location.state as LocationState)?.from?.pathname || '/';

  const handleFieldChange = (name: keyof LoginFormData, value: string) => {
    setFormData((prev) => ({ ...prev, [name]: value }));
    setError('');
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    if (!formData.email || !formData.password) {
      setError('Please enter email and password');
      return;
    }

    // For MVP, use mock authentication
    await new Promise((resolve) => setTimeout(resolve, 500));

    const mockUser = {
      id: '1',
      email: formData.email,
      name: formData.email.split('@')[0],
    };
    const mockToken = 'mock-jwt-token-' + Date.now();

    login(mockUser, mockToken);
    navigate(from, { replace: true });
  };

  return {
    formData,
    error,
    isLoading,
    handleFieldChange,
    handleSubmit,
  };
}

import { useNavigate } from 'react-router-dom';
import { use{{entity.name}}Mutations } from '../../hooks/use{{entity.pluralName}}';
import type { Create{{entity.name}}Dto } from '@/types/{{entity.slug}}';
import type { FormState } from 'informed';

export function use{{entity.name}}CreatePage() {
  const navigate = useNavigate();
  const { create{{entity.name}}, isLoading, error } = use{{entity.name}}Mutations();

  const handleSubmit = async ({ values }: FormState<Create{{entity.name}}Dto>) => {
    const result = await create{{entity.name}}(values);
    if (result) {
      navigate(`/{{entity.slug}}/${result.id}`);
    }
  };

  const validate = (values: Create{{entity.name}}Dto): Record<string, string> | undefined => {
    const errors: Record<string, string> = {};

{{#each entity.fields}}
{{#if showInForm}}
{{#if required}}
    if (!values.{{name}}{{#if (eq type "string")}} || String(values.{{name}}).trim() === ''{{/if}}{{#if (eq type "text")}} || String(values.{{name}}).trim() === ''{{/if}}) {
      errors.{{name}} = '{{label}} is required';
    }
{{/if}}
{{#if minLength}}
    if (values.{{name}} && String(values.{{name}}).length < {{minLength}}) {
      errors.{{name}} = '{{label}} must be at least {{minLength}} characters';
    }
{{/if}}
{{#if maxLength}}
    if (values.{{name}} && String(values.{{name}}).length > {{maxLength}}) {
      errors.{{name}} = '{{label}} must be no more than {{maxLength}} characters';
    }
{{/if}}
{{#if min}}
    if (values.{{name}} !== undefined && Number(values.{{name}}) < {{min}}) {
      errors.{{name}} = '{{label}} must be at least {{min}}';
    }
{{/if}}
{{#if max}}
    if (values.{{name}} !== undefined && Number(values.{{name}}) > {{max}}) {
      errors.{{name}} = '{{label}} must be no more than {{max}}';
    }
{{/if}}
{{/if}}
{{/each}}

    return Object.keys(errors).length > 0 ? errors : undefined;
  };

  return {
    isLoading,
    error,
    handleSubmit,
    validate,
  };
}

import { useMemo } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { use{{entity.name}}, use{{entity.name}}Mutations } from '../../hooks/use{{entity.pluralName}}';
import type { Update{{entity.name}}Dto } from '@/types/{{entity.slug}}';
import type { FormState } from 'informed';

export function use{{entity.name}}EditPage() {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();

  const { {{camelCase entity.name}}, isLoading: isLoadingData, isError, error: loadError } = use{{entity.name}}(id);
  const { update{{entity.name}}, isLoading: isUpdating, error: updateError } = use{{entity.name}}Mutations();

  // Build initial values from fetched data
  const initialValues = useMemo<Update{{entity.name}}Dto>(() => {
    if (!{{camelCase entity.name}}) return {};
    return {
{{#each entity.fields}}
{{#if showInForm}}
      {{name}}: {{camelCase ../entity.name}}.{{name}},
{{/if}}
{{/each}}
    };
  }, [{{camelCase entity.name}}]);

  const handleSubmit = async ({ values }: FormState<Update{{entity.name}}Dto>) => {
    if (!id) return;

    const result = await update{{entity.name}}(id, values);
    if (result) {
      navigate(`/{{entity.slug}}/${id}`);
    }
  };

  return {
    id,
    {{camelCase entity.name}},
    initialValues,
    isLoadingData,
    isUpdating,
    isError,
    loadError,
    updateError,
    handleSubmit,
  };
}
